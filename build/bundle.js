(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};require("babel-polyfill");const t=require("react");var r=e.n(t);const n=require("express");var o=e.n(n);const c=require("react-router-dom/server"),i=require("react-redux"),a=require("react-dom/server"),u=require("serialize-javascript");var l=e.n(u);const s=require("axios");var p=e.n(s),d="GET_USER",f="SAVE",b="RESET";function O(e,t,r,n,o,c,i){try{var a=e[c](i),u=a.value}catch(e){return void r(e)}a.done?t(u):Promise.resolve(u).then(n,o)}var h="TOGGLE_MODE",g="GEOLOCATION",m="GET_LEADER",y={ratingFieldName:"rating",cursor:0,limit:5},v=function(){return function(){var e,t=(e=regeneratorRuntime.mark((function e(t,r,n){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.post("/leaderboard/starship",y,{withCredentials:!0});case 2:o=e.sent,t({type:m,payload:o.data});case 4:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,o){var c=e.apply(t,r);function i(e){O(c,n,o,i,a,"next",e)}function a(e){O(c,n,o,i,a,"throw",e)}i(void 0)}))});return function(e,r,n){return t.apply(this,arguments)}}()};const j={element:function(){var e=(0,i.useSelector)((function(e){return e.mode})).leader,t=(0,i.useDispatch)();return r().useEffect((function(){t(v())}),[]),r().createElement(r().Fragment,null,e&&e.map((function(e){return r().createElement("li",{key:e.data.rating},e.data.first_name)})))},loadData:function(e){return e.dispatch(v())}};function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(Object(r),!0).forEach((function(t){P(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function P(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const k=[w(w({},{element:function(){return r().createElement("div",null,r().createElement("br",null),r().createElement("div",null,"Home!"),r().createElement("button",{onClick:function(){p().post("/signin",{login:"smith",password:"12345678"},{withCredentials:!0}).then((function(e){console.log(e.data)})).catch((function(e){console.log(e)}))}},"SignIn!"),r().createElement("button",{onClick:function(){p().post("/logout",{},{withCredentials:!0}).then((function(e){console.log(e.data)})).catch((function(e){console.log(e)}))}},"LogOut!"),r().createElement("button",{onClick:function(){p().post("/leaderboard",{},{withCredentials:!0}).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))}},"getLeader!"))}}),{},{path:"/"}),w(w({},j),{},{path:"/leader"}),{path:"*",element:function(){return t.createElement("h2",{className:"heading-center"},"Four Oh Four")}}],S=require("redux"),D=require("redux-thunk");var L=e.n(D),C="LOGIN",R="LOGOUT",T="REGISTER";function G(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?G(Object(r),!0).forEach((function(t){q(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):G(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function q(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var A={isLogined:!1,signInError:""};function I(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function x(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?I(Object(r),!0).forEach((function(t){F(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function F(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var N={first_name:"",second_name:"",login:"",email:"",phone:"",avatar:"",display_name:"",id:""},U="TOGGLE_FULLSCREEN",M="SET_SCORE",Q="SET_IS_GAME",V="SET_IS_QUIT";function H(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?H(Object(r),!0).forEach((function(t){B(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function B(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var J={isFullscreen:!1,score:0,isGameStarted:!1,isGameQuited:!1};function K(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function W(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?K(Object(r),!0).forEach((function(t){X(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):K(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function X(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Y={mode:"light",city:"",leader:[]},Z=(0,S.combineReducers)({auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.type,n=t.payload;switch(r){case C:return _(_({},e),{},{isLogined:n.isLogined,signInError:n.error});case R:return _(_({},e),{},{isLogined:!1});case T:return _(_({},e),{},{isRegistered:n.isRegistered,signUpError:n.error});default:return e}},settings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.type,n=t.payload;switch(r){case d:case f:return x(x({},e),n);case b:return{state:N};default:return e}},game:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.type,n=t.payload;switch(r){case U:return z(z({},e),{},{isFullscreen:!e.isFullscreen});case M:return z(z({},e),{},{score:n.score});case Q:return z(z({},e),{},{isGameStarted:n.isGameStarted});case V:return z(z({},e),{},{isGameQuited:n.isGameQuited});default:return e}},mode:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.type,n=t.payload;switch(r){case h:return W(W({},e),{},{mode:"light"===e.mode?"dark":"light"});case g:return W(W({},e),{},{city:n.city});case m:return W(W({},e),{},{leader:n});default:return e}}});const $=require("react-router-dom"),ee=function(){return r().createElement("div",null,r().createElement($.Link,{to:"/"},"Home")," ",r().createElement("br",null),r().createElement($.Link,{to:"/leader"},"Lieder"))},te=function(){return t.createElement("div",null,t.createElement($.Routes,null,t.createElement($.Route,{path:"/",element:r().createElement(r().Fragment,null,r().createElement(ee,null),r().createElement("div",null,r().createElement($.Outlet,null)))},k.map((function(e){var r=e.path,n=e.element;return t.createElement($.Route,{key:r,path:r,element:t.createElement(n,null)})})))))},re=require("cors");var ne=e.n(re);const oe=require("body-parser");var ce=e.n(oe);const ie=require("cookie-parser");var ae=e.n(ie);const ue=require("set-cookie-parser");var le=e.n(ue),se={ratingFieldName:"rating",cursor:0,limit:5},pe=o()();pe.use(ne()()),pe.use(ae()()),pe.use(ce().json()),pe.use("/signin",(function(e,t){p().post("https://ya-praktikum.tech/api/v2/auth/signin",e.body,{withCredentials:!0}).then((function(e){le().parse(e,{decodeValues:!0}).forEach((function(e){return t.cookie(e.name,e.value)})),t.send(e.data)})).catch((function(e){return console.log(e),e}))})),pe.use("/logout",(function(e,t){p().post("https://ya-praktikum.tech/api/v2/auth/logout",{},{withCredentials:!0,headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json",Cookie:e.headers.cookie?e.headers.cookie:""}}).then((function(e){le().parse(e,{decodeValues:!0}).forEach((function(e){return t.cookie(e.name,e.value,{maxAge:0,httpOnly:!0})})),t.send(e.data)})).catch((function(e){return console.log(e),e}))})),pe.use((function(e,t,r){var n=e.cookies&&e.cookies.uuid?e.cookies.uuid:null;return console.log(n),r(),null})),pe.use("/leaderboard",(function(e,t){p().post("https://ya-praktikum.tech/api/v2/leaderboard/starship",se,{withCredentials:!0,headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json",Cookie:e.headers.cookie?e.headers.cookie:""}}).then((function(e){t.send(e.data)})).catch((function(e){return console.log(e),e}))})),pe.use(o().static("public")),pe.get("*",(function(e,t,n){var o,u=function(e){var t=p().create({baseURL:"https://ya-praktikum.tech/api/v2",headers:{cookie:e.get("cookie")||""}});return(0,S.createStore)(Z,{},(0,S.applyMiddleware)(L().withExtraArgument(t)))}(e),s=null===(o=(0,$.matchRoutes)(k,e.url))||void 0===o?void 0:o.map((function(e){var t=e.route;return t.loadData?t.loadData(u):null}));s&&Promise.all(s).then((function(){var n=(0,a.renderToString)(r().createElement(i.Provider,{store:u},r().createElement(c.StaticRouter,{location:e.url},r().createElement(te,null))));t.send('\n        <html>\n          <head></head>\n          <body>\n            <div id="root">'.concat(n,"</div>\n            <script>\n              window.INITIAL_STATE = ").concat(l()(u.getState()),'\n            <\/script>\n            <script src="bundle.js"><\/script>\n          </body>\n        </html>\n      '))})).catch(n)})),pe.listen(3e3,(function(){console.log("Listening on prot 3000")}))})();